<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão de Obras - Contrapartida Viária Av. do Metrô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Frappe Gantt JS e CSS -->
    <script src="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.css">
    <!-- Google Charts (AGORA USADO PARA FÍSICO-FINANCEIRO) -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    
    <style>
        :root {
            --cor-primaria: #01455C;
            --cor-secundaria: #9FC419;
            --cor-texto-claro: #ffffff;
            --cor-texto-escuro: #333;
            --cor-fundo: #f0f2ff;
            --cor-linha-ff: #d95f02; /* Laranja escuro para a linha da Curva S */
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: var(--cor-fundo);
            color: var(--cor-texto-escuro);
        }
        header {
            background-color: var(--cor-primaria);
            padding: 1rem 2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--cor-texto-claro);
        }
        nav ul {
            margin: 0;
            padding: 0;
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
        }
        nav a {
            text-decoration: none;
            color: var(--cor-texto-claro);
            font-weight: 500;
            padding: 0.5rem 0;
            position: relative;
            transition: color 0.3s;
            cursor: pointer;
        }
        nav a.active, nav a:hover {
            color: var(--cor-secundaria);
        }
        nav a.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--cor-secundaria);
        }
        
        /* Botões com transição suave */
        .cta-button, .btn-gantt-view, .phase-tab, #maximize-diario-btn {
            transition: all 0.2s ease-in-out;
        }

        #landing-page {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 70px - 75px);
            padding: 2rem;
            text-align: center;
        }
        .hero {
            max-width: 800px;
        }
        .hero h1 {
            font-size: 3rem;
            color: var(--cor-primaria);
            margin-bottom: 1rem;
        }
        .hero p {
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 2rem;
        }
        .cta-button {
            display: inline-block;
            background-color: var(--cor-secundaria);
            color: var(--cor-primaria);
            font-size: 1.1rem;
            font-weight: bold;
            padding: 0.8rem 2.5rem;
            border-radius: 50px;
            text-decoration: none;
            cursor: pointer;
        }
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(159, 196, 25, 0.4);
        }
        .container {
            max-width: 1400px;
            margin: auto;
            padding: 20px;
        }
        /* Classe de container para largura total com padding */
        .container-full-width {
            width: 100%;
            padding-left: 1.5rem;  /* 24px */
            padding-right: 1.5rem; /* 24px */
            margin-left: auto;
            margin-right: auto;
        }
        .page-content h1 {
            color: var(--cor-primaria);
            margin-bottom: 1.5rem;
            text-align: center;
            font-size: 1.875rem; /* 3xl */
            font-weight: 700;
        }
        .page-content h2 {
             color: var(--cor-primaria);
             text-align: center;
             font-size: 1.5rem; /* 2xl */
             font-weight: 600;
             margin-bottom: 1rem;
        }
        .page-content h3 {
             color: var(--cor-primaria);
             font-size: 1.25rem; /* xl */
             font-weight: 600;
             margin-bottom: 0.75rem;
        }

        /* Estilos da tabela (reaproveitados de 'atas') */
        /* CORREÇÃO: Removido table-layout: fixed e width: 100% para responsividade */
        .styled-table {
            /* table-layout: fixed; */ /* Removido */
            /* width: 100%; */ /* Removido */
        }
        .styled-table th,
        .styled-table td {
            vertical-align: top;
            padding: 0.75rem 1rem; /* 12px 16px */
        }
        .styled-table .break-words {
            word-wrap: break-word;
            word-break: break-word;
            white-space: normal;
            text-align: justify; /* Texto justificado */
        }
        .styled-table th {
            font-size: 0.75rem; /* 12px */
            font-weight: 500;
            text-transform: uppercase;
            color: #6b7280; /* text-gray-500 */
            text-align: left;
        }
        .styled-table td {
            font-size: 0.875rem; /* 14px */
            color: #374151; /* text-gray-700 */
        }
        .styled-table tbody tr {
            transition: background-color 0.2s ease-in-out;
        }
        .styled-table tbody tr:nth-child(odd) {
            background-color: #ffffff;
        }
        .styled-table tbody tr:nth-child(even) {
            background-color: #f9fafb; /* bg-gray-50 */
        }
        .styled-table tbody tr:hover {
            background-color: #f3f4f6; /* Equivalent to hover:bg-gray-100 */
        }

        /* Estilos para Frappe Gantt */
        .gantt .bar-progress {
            fill: var(--cor-secundaria) !important; /* Cor do progresso */
        }
        .gantt .bar {
            fill: var(--cor-primaria) !important; /* Cor principal da barra */
        }
        .gantt .bar-label {
            font-weight: 500;
            font-size: 13px;
            fill: #fff !important; /* Cor do texto dentro da barra */
        }
        .gantt .bar-label.big {
             fill: var(--cor-texto-escuro) !important; /* Cor do texto fora da barra */
             font-weight: 500;
        }
        
        .gantt-today-marker .line-today {
            stroke: #ef4444 !important; /* Cor vermelha (red-500) */
            stroke-width: 2 !important;
            stroke-dasharray: 4, 4 !important;
        }
        .gantt-today-marker .today-text {
            fill: #dc2626 !important; /* Vermelho mais escuro (red-600) */
            font-weight: 600 !important;
        }

        .gantt-wrapper-outer {
             border: 1px solid #e5e7eb; /* Borda suave */
             border-radius: 8px; /* Cantos arredondados */
             overflow-x: auto; /* Mantém apenas o scroll horizontal necessário */
        }

        .gantt-wrapper-outer .gantt {
            overflow-y: hidden !important; /* Força a biblioteca a não mostrar o scroll Y */
        }

        .btn-gantt-view {
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
            color: #374151;
            padding: 0.3rem 0.8rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
        }
        .btn-gantt-view:hover {
            background-color: #e5e7eb;
        }
        .btn-gantt-view.active {
            background-color: var(--cor-primaria);
            color: white;
            border-color: var(--cor-primaria);
        }

        /* Estilos para os botões-abas de Fase */
        .phase-tab {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            background-color: transparent;
            color: #6b7280; /* Cor de inativo (cinza) */
            border-bottom: 3px solid transparent;
            cursor: pointer;
            margin-bottom: -2px; /* Alinha com a borda inferior */
        }
        .phase-tab:hover {
            color: var(--cor-primaria);
            background-color: #f9fafb; /* bg-gray-50 */
        }
        .phase-tab.active {
            color: var(--cor-primaria);
            border-bottom-color: var(--cor-primaria);
            background-color: transparent; /* Garante que o fundo saia ao estar ativo */
        }
        .phase-tab.active:hover {
             background-color: transparent; /* Impede o hover de mudar o fundo da aba ativa */
        }

        /* Estilos para a tabela de progresso */
        .progress-table-wrapper {
            max-height: 40vh; /* Limita a altura */
            overflow-y: auto; /* Adiciona scroll vertical */
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background-color: #ffffff;
            display: none; /* Oculto por padrão, JS controla a visibilidade */
        }
        .progress-table {
            width: 100%;
            border-collapse: collapse;
        }
        .progress-table th, .progress-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e5e7eb;
            text-align: left;
            white-space: nowrap;
        }
        .progress-table th {
            background-color: #f9fafb; /* bg-gray-50 */
            font-weight: 600;
            color: #374151; /* text-gray-700 */
            position: sticky; /* Cabeçalho fixo */
            top: 0;
        }
        .progress-table tbody tr {
            transition: background-color 0.2s ease-in-out;
        }
        .progress-table tbody tr:hover {
            background-color: #f3f4f6; /* bg-gray-100 */
        }
        .progress-table td:first-child {
            white-space: normal; /* Permite que o nome da tarefa quebre a linha */
        }
        .progress-bar-cell {
            display: flex;
            align-items: center;
            gap: 0.5rem; /* 8px */
        }
        .progress-bar-bg {
            width: 100px;
            height: 16px;
            background-color: #e5e7eb; /* bg-gray-200 */
            border-radius: 8px;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            background-color: var(--cor-secundaria); /* Verde */
            border-radius: 8px;
            transition: width 0.3s ease;
        }
        .progress-text {
            width: 40px; /* Espaço para o texto (ex: 100%) */
            font-weight: 500;
            font-size: 0.875rem;
        }

        /* Estilos para o KPI */
        .kpi-card {
            background-color: #ffffff;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            padding: 1.5rem; /* 24px */
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
        }
        .kpi-title {
            font-size: 1.125rem; /* 18px */
            font-weight: 600;
            color: var(--cor-primaria);
            margin-bottom: 1rem; /* 16px */
        }
        .kpi-value {
            font-size: 2.25rem; /* 36px */
            font-weight: 800;
            color: var(--cor-secundaria);
            line-height: 1;
        }
        .kpi-progress-bar-bg {
            width: 100%;
            height: 24px;
            background-color: #e5e7eb; /* bg-gray-200 */
            border-radius: 12px;
            overflow: hidden;
            margin-top: 1rem; /* 16px */
            position: relative; /* Contexto para o marcador */
        }
        .kpi-progress-bar-fill {
            height: 100%;
            background-color: var(--cor-secundaria);
            border-radius: 12px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--cor-primaria);
            font-weight: 600;
            font-size: 0.875rem;
            position: relative; /* Para garantir que fique abaixo do marcador */
            z-index: 1;
        }
        .kpi-meta {
            margin-top: 0.75rem; /* 12px */
            font-size: 0.875rem; /* 14px */
            color: #6b7280; /* text-gray-500 */
        }
        
        .kpi-limit-marker {
            position: absolute;
            top: -4px; /* Ajuste para centralizar na barra */
            bottom: -4px;
            left: 62.24%; /* ATUALIZADO: Posição calculada (24000 / 38561.224) */
            width: 3px; /* Largura da linha */
            background-color: #ef4444; /* Vermelho (red-500) */
            border-radius: 2px;
            z-index: 2; /* Fica por cima da barra de progresso */
            cursor: help; /* Indica que tem tooltip */
        }
        .kpi-limit-marker .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #1f2937; /* bg-gray-800 */
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 10;
            bottom: 125%; /* Posição acima do marcador */
            left: 50%;
            margin-left: -100px; /* Metade da largura para centralizar */
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem; /* 12px */
            font-weight: 400;
            line-height: 1.4;
        }
        .kpi-limit-marker:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .kpi-legend {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem; /* 8px */
            margin-top: 1rem; /* 16px */
            font-size: 0.875rem; /* 14px */
            color: #4b5563; /* text-gray-600 */
        }
        .kpi-legend-line {
            width: 24px;
            height: 3px;
            background-color: #ef4444; /* Vermelho (red-500) */
            border-radius: 2px;
        }

        .ff-chart-wrapper {
            width: 100%;
            min-height: 500px; /* Altura mínima para o gráfico */
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            background-color: #ffffff;
        }

        /* --- NOVOS ESTILOS: Indicador de Carregamento (Spinner) --- */
        .loading-spinner {
            display: none; /* Oculto por padrão */
            width: 48px;
            height: 48px;
            border: 5px solid var(--cor-primaria);
            border-bottom-color: transparent;
            border-radius: 50%;
            margin: 4rem auto; /* Centraliza */
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        /* --- FIM NOVOS ESTILOS --- */


        /* Otimização para impressão */
        @media print {
            body {
                background-color: white !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            header, nav, footer, .cta-button, .kpi-card, .progress-table-wrapper, .progress-title, #diario-page, #maximize-diario-btn {
                display: none !important;
            }
            .container, .container-full-width {
                max-width: none !important;
                padding: 10px !important;
                width: 100%;
                box-shadow: none !important;
                border: none !important;
            }
            .page-content, .page-content > div {
                box-shadow: none !important;
                border: none !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            .styled-table {
                font-size: 10px !important;
                table-layout: auto;
            }
            .styled-table th,
            .styled-table td {
                padding: 4px 6px !important;
            }
            .styled-table tbody tr {
                page-break-inside: avoid;
            }
            .gantt-wrapper-outer {
                max-height: none !important;
                overflow: visible !important;
                border: none !important;
            }
            .ff-chart-wrapper {
                border: none !important;
                padding: 0 !important;
                min-height: auto !important;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    
    <header>
        <div class="logo">Gestão de Obras</div>
        <nav>
            <ul>
                <li><a id="nav-home" class="active">Página Principal</a></li>
                <li><a id="nav-assuntos">Assuntos Relevantes</a></li>
                <li><a id="nav-planejamento">Planejamento</a></li>
                <!-- Guia oculta -->
                <li style="display: none;"><a id="nav-fisico-financeiro">Físico-Financeiro</a></li>
                <li><a id="nav-gestao-cava">Gestão Cava</a></li>
                <!-- NOVA GUIA -->
                <li><a id="nav-suprimentos">Gestão de Suprimentos</a></li>
                <li><a id="nav-diario">Diário de Obra</a></li>
            </ul>
        </nav>
    </header>
    
    <main>
        <!-- Página Principal -->
        <section id="landing-page" class="container page-content" style="display: flex;">
            <div class="hero">
                <h1>Sistema de Gestão de Obras</h1>
                <h2>Contrapartida Viária Avênida do Metrô</h2>
                <p>
                    Plataforma centralizada para o monitoramento e gestão de todas as frentes da obra. Navegue pelas guias para acessar a painéis de assuntos, planejamento, análise de riscos, controle de custos e gestão de cava.
                </p>
                <a id="cta-button" class="cta-button">Acessar aos Painéis</a>
            </div>
        </section>

        <!-- Página Assuntos Relevantes -->
        <section id="assuntos-page" class="container page-content" style="display: none;">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h1>Assuntos Relevantes</h1>
                <!-- Indicador de Carregamento -->
                <div id="assuntos-loading" class="loading-spinner"></div>
                <!-- Mensagem de Erro -->
                <div id="assuntos-error" class="hidden text-center p-4 text-red-600 bg-red-100 border border-red-400 rounded-lg"></div>
                <!-- Tabela de Assuntos -->
                <div id="assuntos-content" class="overflow-x-auto rounded-lg border border-gray-200" style="display: none;">
                    <table id="assuntos-table" class="styled-table divide-y divide-gray-200">
                        <thead class="bg-gray-100">
                            <tr>
                                <!-- CORREÇÃO: Larguras mínimas fixas para responsividade móvel -->
                                <th class="w-[5rem]">Item</th>
                                <th class="w-[12rem]">Assunto</th>
                                <th class="w-[40rem]">Descrição</th>
                                <th class="w-[12rem]">Responsável</th>
                            </tr>
                        </thead>
                        <tbody id="assuntos-table-body" class="divide-y divide-gray-200">
                            <!-- O conteúdo será carregado pelo JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Página Planejamento -->
        <section id="planejamento-page" class="container-full-width page-content" style="display: none; padding-top: 20px;">
             <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h1>Gráfico de Gantt do Projeto</h1>
                
                <!-- Indicador de Carregamento -->
                <div id="planejamento-loading" class="loading-spinner"></div>
                <!-- Mensagem de Erro -->
                <div id="planejamento-error" class="hidden text-center p-4 text-red-600 bg-red-100 border border-red-400 rounded-lg"></div>
                
                <!-- Conteúdo do Planejamento (oculto até carregar) -->
                <div id="planejamento-content" style="display: none;">
                    <div class="flex justify-center border-b border-gray-300 mb-4">
                        <button id="btn-fase-1" class="phase-tab active">FASE 01</button>
                        <button id="btn-fase-2" class="phase-tab">FASE 02</button>
                    </div>

                    <div class="flex flex-col md:flex-row items-center justify-end mb-4 gap-2">
                        <span class="text-sm font-medium text-gray-700">Zoom:</span>
                        <button id="gantt-view-day" class="btn-gantt-view">Dia</button>
                        <button id="gantt-view-week" class="btn-gantt-view active">Semana</button>
                        <button id="gantt-view-month" class="btn-gantt-view">Mês</button>
                    </div>

                    <div id="gantt-fase-1-wrapper" class="gantt-wrapper-outer mt-4">
                        <div id="gantt-chart-fase-1"></div>
                    </div>

                    <div id="gantt-fase-2-wrapper" class="gantt-wrapper-outer mt-4" style="display: none;">
                        <div id="gantt-chart-fase-2"></div>
                    </div>

                    <div class="mt-8">
                        <h2 class="progress-title">
                            Avanço Previsto (Data de Controle: <span id="control-date-display">--/--/----</span>)
                        </h2>
                        
                        <div id="progress-table-fase-1" class="progress-table-wrapper" style="display: block;">
                            <!-- A tabela será gerada pelo JS -->
                        </div>

                        <div id="progress-table-fase-2" class="progress-table-wrapper" style="display: none;">
                            <!-- A tabela será gerada pelo JS -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Página Físico-Financeiro (Oculta) -->
        <section id="fisico-financeiro-page" class="container-full-width page-content" style="display: none; padding-top: 20px;">
             <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h1>Curva S - Físico-Financeiro</h1>
                
                <!-- Indicador de Carregamento -->
                <div id="ff-loading" class="loading-spinner"></div>
                <!-- Mensagem de Erro -->
                <div id="ff-error" class="hidden text-center p-4 text-red-600 bg-red-100 border border-red-400 rounded-lg"></div>
                
                <!-- Conteúdo do FF (oculto até carregar) -->
                <div id="ff-content" style="display: none;">
                    <div class="flex justify-center border-b border-gray-300 mb-4">
                        <button id="btn-ff-fase-1" class="phase-tab active">FASE 01</button>
                        <button id="btn-ff-fase-2" class="phase-tab">FASE 02</button>
                    </div>

                    <!-- Wrapper do Gráfico Fase 1 -->
                    <div id="ff-chart-fase-1-wrapper" class="ff-chart-wrapper" style="display: block;">
                        <div id="ff-chart-fase-1" style="width: 100%; height: 500px;"></div>
                    </div>
                    
                    <!-- Wrapper do Gráfico Fase 2 -->
                    <div id="ff-chart-fase-2-wrapper" class="ff-chart-wrapper" style="display: none;">
                        <div id="ff-chart-fase-2" style="width: 100%; height: 500px;"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Página Gestão Cava -->
        <section id="gestao-cava-page" class="container page-content" style="display: none;">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h1>Gestão Cava - Controle de Escavação</h1>
                
                <!-- Indicador de Carregamento -->
                <div id="cava-loading" class="loading-spinner"></div>
                <!-- Mensagem de Erro -->
                <div id="cava-error" class="hidden text-center p-4 text-red-600 bg-red-100 border border-red-400 rounded-lg"></div>

                <!-- Conteúdo Cava (oculto até carregar) -->
                <div id="cava-content" style="display: none;">
                    <div class="max-w-md mx-auto my-8">
                        <div class="kpi-card">
                            <h3 class="kpi-title">Avanço Total da Escavação</h3>
                            <div class="kpi-value" id="kpi-cava-percent">0%</div>
                            <div class="kpi-progress-bar-bg">
                                <div id="kpi-cava-bar" class="kpi-progress-bar-fill" style="width: 0%;">
                                    <span id="kpi-cava-bar-text">0%</span>
                                </div>
                                <div class="kpi-limit-marker" style="left: 62.24%;">
                                    <span class="tooltip-text">*Limite contratado CAVA (24.000 m³), consórcio precisar revisar o contrato com o fornecedor.</span>
                                </div>
                            </div>
                            <p class="kpi-meta">
                                <span id="kpi-cava-acumulado">0,00</span> m³ de <span id="kpi-cava-total">38.561,224</span> m³
                            </p>
                            
                            <div class="kpi-legend">
                                <span class="kpi-legend-line"></span>
                                Limite contratual (24.000 m³)
                            </div>
                        </div>
                    </div>
                    
                    <h2 class="mt-8">Histórico de Escavação</h2>
                    <div class="overflow-x-auto rounded-lg border border-gray-200">
                        <table id="cava-table" class="styled-table min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th>Data</th>
                                    <th>Viagens</th>
                                    <th>Viagens Acum</th>
                                    <th>Volume Aprox</th>
                                    <th>Volume Acum</th>
                                    <th>OBS</th>
                                </tr>
                            </thead>
                            <tbody id="cava-table-body" class="divide-y divide-gray-200">
                                <!-- Os dados serão carregados pelo JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- NOVA PÁGINA: Gestão de Suprimentos -->
        <section id="suprimentos-page" class="container-full-width page-content" style="display: none; padding-top: 20px;">
             <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h1>Gestão de Suprimentos - Matriz de Kraljic</h1>
                
                <!-- Indicador de Carregamento -->
                <div id="suprimentos-loading" class="loading-spinner"></div>
                <!-- Mensagem de Erro -->
                <div id="suprimentos-error" class="hidden text-center p-4 text-red-600 bg-red-100 border border-red-400 rounded-lg"></div>

                <!-- Conteúdo Suprimentos (oculto até carregar) -->
                <div id="suprimentos-content" style="display: none;">
                    
                    <!-- Matriz de Kraljic -->
                    <h2 class="mt-4">Matriz de Risco vs. Impacto no Prazo</h2>
                    <div id="kraljic-chart-wrapper" class="w-full h-[500px] border border-gray-300 rounded-lg p-4 bg-gray-50">
                        <div id="kraljic-chart" style="width: 100%; height: 100%;"></div>
                    </div>

                    <!-- Resumo dos Quadrantes -->
                    <div class="mt-6 p-4 bg-gray-50 rounded-lg shadow-inner border border-gray-200">
                        <h3 class="text-xl font-semibold mb-4 text-center" style="color: var(--cor-primaria);">Resumo dos Quadrantes Estratégicos</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 text-sm">
                            <div>
                                <h4 class="font-bold text-gray-800">Itens Estratégicos (Alto Risco, Alto Impacto no Prazo)</h4>
                                <p class="text-gray-700">Críticos para o prazo e difíceis de obter. Exigem gestão de topo e parcerias estratégicas com fornecedores.</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800">Itens de Alavancagem (Baixo Risco, Alto Impacto no Prazo)</h4>
                                <p class="text-gray-700">Itens importantes para o prazo, mas fáceis de comprar. O foco deve ser a negociação de preços e condições (ex: cimento, aço comum).</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800">Itens de Gargalo (Alto Risco, Baixo Impacto no Prazo)</h4>
                                <p class="text-gray-700">Não têm grande impacto direto no prazo, mas a sua falta (por ser item raro ou de fornecedor único) pode parar a obra. Focar em garantir o fornecimento.</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800">Itens Não Críticos (Baixo Risco, Baixo Impacto no Prazo)</h4>
                                <p class="text-gray-700">Itens de rotina, fáceis de comprar e com baixo impacto. O foco deve ser em simplificar e automatizar o processo de compra (ex: EPIs, pregos).</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tabela de Suprimentos -->
                    <h2 class="mt-8">Tabela de Acompanhamento de Suprimentos</h2>
                    <div id="suprimentos-table-wrapper" class="overflow-x-auto rounded-lg border border-gray-200">
                        <table id="suprimentos-table" class="styled-table divide-y divide-gray-200">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="w-[8rem]">ID</th>
                                    <th class="w-[20rem]">Item</th>
                                    <th class="w-[12rem]">Categoria</th>
                                    <th class="w-[15rem]">Fornecedor Principal</th>
                                    <th class="w-[10rem]">Status Entrega</th>
                                    <th class="w-[6rem] text-center">Impacto Prazo</th>
                                    <th class="w-[6rem] text-center">Risco Fornec.</th>
                                </tr>
                            </thead>
                            <tbody id="suprimentos-table-body" class="divide-y divide-gray-200">
                                <!-- O conteúdo será carregado pelo JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </section>

        <!-- Página Diário de Obra -->
        <section id="diario-page" class="container-full-width page-content" style="display: none; padding-top: 20px;">
             <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h1>Diário de Obra</h1>
                
                <div class="flex justify-end mb-4">
                    <button id="maximize-diario-btn" class="bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-5h-4m0 0v4m0-4l-5 5M4 16v4m0 0h4m0 0l5-5m11 5h-4m0 0v-4m0 4l-5-5" />
                        </svg>
                        Maximizar
                    </button>
                </div>
                
                <!-- Container para iframe (para fullscreen) -->
                <div id="diario-iframe-container" class="w-full h-[80vh] border border-gray-300 rounded-lg overflow-hidden bg-gray-100">
                    <iframe id="diario-iframe" 
                            src="https://web.diariodeobra.app/#/app/obras" 
                            class="w-full h-full border-0"
                            sandbox="allow-same-origin allow-scripts allow-popups allow-forms">
                    </iframe>
                </div>
                 <p class="text-sm text-gray-500 mt-2 text-center">Carregando Diário de Obra... (Se a tela permanecer em branco, clique em "Maximizar" ou abra o link <a href="https://web.diariodeobra.app/#/app/obras" target="_blank" class="text-blue-600 hover:underline">numa nova guia</a>).</p>
            </div>
        </section>
    </main>
    
    <footer class="bg-white text-center p-4 mt-8">
        <p class="text-sm text-gray-600">Sistema de Gestão de Obras © 2025</p>
    </footer>

<script>
    /**
     * Script principal do Dashboard de Gestão de Obras
     * Este script controla a navegação entre as páginas (abas),
     * carrega dados de ficheiros .jsonl externos para as guias
     * "Assuntos Relevantes", "Planejamento" e "Gestão Cava",
     * e renderiza os gráficos (Gantt e Curva S).
     */
    document.addEventListener('DOMContentLoaded', function () {
        
        // --- Seletores de Elementos Globais ---
        const navLinks = document.querySelectorAll('nav a');
        const pages = document.querySelectorAll('.page-content');
        const landingPage = document.getElementById('landing-page');
        const ctaButton = document.getElementById('cta-button');
        
        // --- Flags de Inicialização (Evita recarregamento) ---
        let planejamentoInicializado = false;
        let fisicoFinanceiroInicializado = false;
        let assuntosInicializado = false;
        let cavaInicializada = false;
        let suprimentosInicializado = false; // NOVA FLAG
        
        // --- Funções Auxiliares de Exibição ---

        /**
         * Esconde todos os indicadores de carregamento (spinners).
         */
        function hideAllLoaders() {
            document.querySelectorAll('.loading-spinner').forEach(spinner => {
                spinner.style.display = 'none';
            });
        }
        
        /**
         * Oculta todas as páginas de conteúdo e a página principal.
         */
        function hideAllPages() {
            pages.forEach(page => page.style.display = 'none');
            landingPage.style.display = 'none';
        }

        /**
         * Exibe a página solicitada e inicializa seus dados se for a primeira vez.
         * @param {string} pageId - O ID da página a ser exibida (ex: 'assuntos-page').
         */
        function showPage(pageId) {
            hideAllPages();
            
            // Ativa o link de navegação correspondente
            navLinks.forEach(link => {
                const linkPageId = (link.id === 'nav-home') ? 'landing-page' : link.id.replace('nav-', '') + '-page';
                link.classList.toggle('active', linkPageId === pageId);
            });

            // Encontra e exibe a página
            const pageToShow = document.getElementById(pageId);
            if (pageToShow) {
                pageToShow.style.display = 'block';
                if (pageId === 'landing-page') {
                    pageToShow.style.display = 'flex';
                }
            } else {
                console.error("Página não encontrada:", pageId);
                document.getElementById('landing-page').style.display = 'flex'; // Volta para a Home
                return;
            }
            
            // --- Lógica de Inicialização de Página (Carregamento de Dados) ---
            // Cada página só é inicializada uma vez.
            
            try {
                if (pageId === 'assuntos-page' && !assuntosInicializado) {
                    initializeAssuntosPage(); // Função Async
                    assuntosInicializado = true;
                }
                if (pageId === 'planejamento-page' && !planejamentoInicializado) {
                    initializeGanttPage(); // Função Async
                    planejamentoInicializado = true;
                }
                if (pageId === 'fisico-financeiro-page' && !fisicoFinanceiroInicializado) {
                    initializeFisicoFinanceiroPage(); // Carrega Google Charts (tem seu próprio callback)
                    // A flag 'fisicoFinanceiroInicializado' é definida dentro do callback do Google Charts
                }
                if (pageId === 'gestao-cava-page' && !cavaInicializada) {
                    loadCavaData(); // Função Async
                    cavaInicializada = true;
                }
                // NOVO: Inicializa a página de Suprimentos
                if (pageId === 'suprimentos-page' && !suprimentosInicializado) {
                    initializeSuprimentosPage();
                    suprimentosInicializado = true;
                }
            } catch (error) {
                console.error(`Falha ao inicializar a página ${pageId}:`, error);
                // Exibe um erro genérico se a inicialização falhar
                const errorDiv = document.getElementById(pageId.replace('-page', '-error'));
                if(errorDiv) {
                    errorDiv.textContent = `Erro crítico ao carregar a página: ${error.message}`;
                    errorDiv.style.display = 'block';
                }
            }
        }

        // --- Event Listeners da Navegação ---
        navLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                const navId = event.currentTarget.id;
                const pageId = (navId === 'nav-home') ? 'landing-page' : navId.replace('nav-', '') + '-page';
                showPage(pageId);
            });
        });

        // ATUALIZADO: Botão CTA agora aponta para Assuntos Relevantes
        ctaButton.addEventListener('click', () => showPage('assuntos-page')); 
        showPage('landing-page'); // Exibe a página principal ao carregar

        // --- Lógica da Página: Diário de Obra (Iframe) ---
        const maximizeDiarioBtn = document.getElementById('maximize-diario-btn');
        const diarioIframeContainer = document.getElementById('diario-iframe-container');

        if (maximizeDiarioBtn && diarioIframeContainer) {
            maximizeDiarioBtn.addEventListener('click', () => {
                // Tenta entrar em tela cheia com prefixos de navegador
                if (diarioIframeContainer.requestFullscreen) {
                    diarioIframeContainer.requestFullscreen();
                } else if (diarioIframeContainer.webkitRequestFullscreen) { /* Safari */
                    diarioIframeContainer.webkitRequestFullscreen();
                } else if (diarioIframeContainer.msRequestFullscreen) { /* IE11 */
                    diarioIframeContainer.msRequestFullscreen();
                }
            });
        }
        
        // --- Lógica da Página: Assuntos Relevantes (Carregamento JSONL) ---
        
        /**
         * Inicializa a página de Assuntos Relevantes, carregando do .jsonl ou localStorage.
         */
        async function initializeAssuntosPage() {
            const tableBody = document.getElementById('assuntos-table-body');
            const loading = document.getElementById('assuntos-loading');
            const errorDiv = document.getElementById('assuntos-error');
            const contentDiv = document.getElementById('assuntos-content');

            if (!tableBody || !loading || !errorDiv || !contentDiv) return;

            loading.style.display = 'block'; // Mostra o spinner
            errorDiv.style.display = 'none';
            contentDiv.style.display = 'none';

            try {
                // Tenta carregar dados do localStorage primeiro
                const storedData = localStorage.getItem('assuntos-db');
                if (storedData) {
                    console.log('Carregando Assuntos do localStorage.');
                    renderAssuntosTable(JSON.parse(storedData));
                } else {
                    console.log('Buscando assuntos.jsonl...');
                    const response = await fetch('assuntos.jsonl'); // Carrega o arquivo
                    if (!response.ok) {
                        throw new Error(`Não foi possível carregar assuntos.jsonl (Status: ${response.status})`);
                    }
                    const text = await response.text();
                    const lines = text.trim().split('\n');
                    
                    if (lines.length === 0 || (lines.length === 1 && lines[0] === '')) {
                         throw new Error('O ficheiro assuntos.jsonl está vazio.');
                    }

                    const data = [];
                    lines.forEach((line) => {
                        if (line.trim() === '') return;
                        try {
                            data.push(JSON.parse(line));
                        } catch (e) {
                            console.warn('Erro ao parsear linha do assuntos.jsonl:', line, e);
                        }
                    });
                    
                    localStorage.setItem('assuntos-db', JSON.stringify(data)); // Salva no localStorage
                    renderAssuntosTable(data); // Renderiza a tabela
                }
            } catch (error) {
                console.error("Falha ao carregar o banco de dados de Assuntos:", error);
                errorDiv.textContent = `Erro ao carregar dados: ${error.message}`;
                errorDiv.style.display = 'block';
            } finally {
                loading.style.display = 'none'; // Esconde o spinner
            }
        }
        
        /**
         * Renderiza os dados dos Assuntos na tabela.
         * @param {Array} data - Array de objetos de assuntos.
         */
        function renderAssuntosTable(data) {
            const tableBody = document.getElementById('assuntos-table-body');
            const contentDiv = document.getElementById('assuntos-content');
            let tableHTML = "";

            data.forEach((item) => {
                // Converte quebras de linha \n para <br>
                const descricaoHtml = item.descricao.replace(/\n/g, '<br>');
                tableHTML += `
                    <tr>
                        <td class="text-center font-medium">${item.item}</td>
                        <td class="break-words">${item.assunto}</td>
                        <td class="break-words">${descricaoHtml}</td>
                        <td class="whitespace-nowrap">${item.responsavel}</td>
                    </tr>
                `;
            });

            tableBody.innerHTML = tableHTML; // Insere todo o HTML de uma vez
            contentDiv.style.display = 'block'; // Mostra o conteúdo
        }

        // --- Lógica da Página: Gestão Cava (Carregamento JSONL) ---
        
        /**
         * Inicializa a página de Gestão Cava, carregando do .jsonl ou localStorage.
         */
        async function loadCavaData() {
            const tableBody = document.getElementById('cava-table-body');
            const loading = document.getElementById('cava-loading');
            const errorDiv = document.getElementById('cava-error');
            const contentDiv = document.getElementById('cava-content');

            if (!tableBody || !loading || !errorDiv || !contentDiv) return;

            loading.style.display = 'block';
            errorDiv.style.display = 'none';
            contentDiv.style.display = 'none';

            let ultimoVolumeAcumulado = 0; // Para o KPI

            try {
                // Tenta carregar do localStorage
                const storedData = localStorage.getItem('gestao-cava-db');
                if(storedData) {
                    console.log('Carregando Gestão Cava do localStorage.');
                    ultimoVolumeAcumulado = renderCavaTable(JSON.parse(storedData));
                } else {
                    console.log('Buscando gestao_cava.jsonl...');
                    const response = await fetch('gestao_cava.jsonl'); // Carrega o novo arquivo
                    if (!response.ok) {
                        throw new Error(`Não foi possível carregar gestao_cava.jsonl (Status: ${response.status})`);
                    }
                    const text = await response.text();
                    const lines = text.trim().split('\n');
                    
                    if (lines.length === 0 || (lines.length === 1 && lines[0] === '')) {
                         throw new Error('O ficheiro gestao_cava.jsonl está vazio.');
                    }
                    
                    const data = [];
                    lines.forEach((line) => {
                        if (line.trim() === '') return;
                        try {
                            data.push(JSON.parse(line));
                        } catch (e) {
                            console.warn('Erro ao parsear linha do gestao_cava.jsonl:', line, e);
                        }
                    });
                    
                    localStorage.setItem('gestao-cava-db', JSON.stringify(data)); // Salva no localStorage
                    ultimoVolumeAcumulado = renderCavaTable(data); // Renderiza e obtém o último valor
                }
                
                // Atualiza o KPI com o último valor válido encontrado
                updateCavaKPI(ultimoVolumeAcumulado);

            } catch (error) {
                console.error("Falha ao carregar o banco de dados da Cava:", error);
                errorDiv.textContent = `Erro ao carregar dados: ${error.message}`;
                errorDiv.style.display = 'block';
                updateCavaKPI(0); // Zera o KPI em caso de erro
            } finally {
                loading.style.display = 'none'; // Esconde o spinner
            }
        }
        
        /**
         * Renderiza os dados da Cava na tabela.
         * @param {Array} data - Array de objetos de registro da cava.
         * @returns {number} - O último volume acumulado encontrado.
         */
        function renderCavaTable(data) {
            const tableBody = document.getElementById('cava-table-body');
            const contentDiv = document.getElementById('cava-content');
            let tableHTML = "";
            let ultimoVolumeAcumulado = 0;

            data.forEach((item) => {
                // Define estilos com base no OBS
                let trClass = '';
                if (item.obs.includes('Dom')) trClass = 'style="background-color: #fff7ed;"'; // Fundo Dom
                if (item.obs.includes('Chuva') || item.obs.includes('molhado')) trClass = 'style="background-color: #fef2f2;"'; // Fundo Chuva
                
                let obsStyle = item.obs.includes('Prev') ? 'style="color: #ea580c;"' : '';
                let numStyle = item.obs.includes('Prev') ? 'style="color: #dc2626;"' : ''; // Vermelho para Previsto

                tableHTML += `
                    <tr ${trClass}>
                        <td>${item.data || ''}</td>
                        <td ${numStyle}>${item.viagens || ''}</td>
                        <td ${numStyle}>${item.viagens_acum || ''}</td>
                        <td ${numStyle}>${item.volume_aprox || ''}</td>
                        <td ${numStyle}>${item.volume_acum || ''}</td>
                        <td ${obsStyle}>${item.obs || ''}</td>
                    </tr>
                `;
                
                // Atualiza o último volume acumulado para o KPI
                // Remove pontos de milhar, substitui vírgula por ponto decimal
                const volAcumLimpo = item.volume_acum.replace(/\./g, '').replace(',', '.');
                const volFloat = parseFloat(volAcumLimpo);
                if (!isNaN(volFloat)) {
                    ultimoVolumeAcumulado = volFloat;
                }
            });

            tableBody.innerHTML = tableHTML; // Insere todo o HTML de uma vez
            contentDiv.style.display = 'block'; // Mostra o conteúdo
            return ultimoVolumeAcumulado;
        }

        /**
         * Atualiza o KPI de Gestão Cava com base no volume.
         * @param {number} volumeAcumulado - O volume acumulado total.
         */
        function updateCavaKPI(volumeAcumulado) {
            const volumeTotal = 38561.224; // m³
            const percentual = (volumeAcumulado / volumeTotal) * 100;
            const percentualFormatado = percentual.toFixed(2);
            
            function formatNumber(num) {
                return num.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            }
            function formatNumberMeta(num) {
                 return num.toLocaleString('pt-BR', { minimumFractionDigits: 3, maximumFractionDigits: 3 });
            }

            const kpiPercent = document.getElementById('kpi-cava-percent');
            const kpiBar = document.getElementById('kpi-cava-bar');
            const kpiBarText = document.getElementById('kpi-cava-bar-text');
            const kpiAcumulado = document.getElementById('kpi-cava-acumulado');
            const kpiTotal = document.getElementById('kpi-cava-total');
            
            if (kpiPercent) kpiPercent.textContent = `${percentualFormatado}%`;
            if (kpiBar) kpiBar.style.width = `${percentualFormatado}%`;
            if (kpiBarText) kpiBarText.textContent = `${percentual.toFixed(1)}%`;
            if (kpiAcumulado) kpiAcumulado.textContent = formatNumber(volumeAcumulado);
            if (kpiTotal) kpiTotal.textContent = formatNumberMeta(volumeTotal);
        }

        // --- Lógica da Página: Físico-Financeiro (Google Charts) ---
        function initializeFisicoFinanceiroPage() {
            const loading = document.getElementById('ff-loading');
            const errorDiv = document.getElementById('ff-error');
            const contentDiv = document.getElementById('ff-content');
            
            loading.style.display = 'block';
            errorDiv.style.display = 'none';
            contentDiv.style.display = 'none';
            
            // Carrega a biblioteca e define a função de callback
            try {
                google.charts.load('current', {'packages':['corechart']});
                google.charts.setOnLoadCallback(drawFFCharts);
            } catch(e) {
                 console.error("Falha ao carregar Google Charts:", e);
                 errorDiv.textContent = 'Erro ao carregar a biblioteca de gráficos do Google.';
                 errorDiv.style.display = 'block';
                 loading.style.display = 'none';
            }

            let formatter; // Declarado no escopo da função de inicialização

            // Função para formatar os dados da Tooltip
            function createTooltip(periodo, despInd, trecho, cumul) {
                if (!formatter) return ''; // Proteção
                return `
                    <div class="p-2 shadow-md rounded-md bg-white text-sm" style="min-width: 250px;">
                        <h4 class="font-bold text-base mb-2" style="color: var(--cor-primaria);">${periodo}</h4>
                        <div class="flex justify-between"><span>Despesas Indiretas:</span> <span class="font-medium">${formatter.formatValue(despInd)}</span></div>
                        <div class="flex justify-between"><span>Trecho: Av. Marginal:</span> <span class="font-medium">${formatter.formatValue(trecho)}</span></div>
                        <hr class="my-1">
                        <div class="flex justify-between font-bold"><span>Total Período:</span> <span>${formatter.formatValue(despInd + trecho)}</span></div>
                        <div class="flex justify-between font-bold mt-2" style="color: var(--cor-linha-ff);">
                            <span>Cumulativo:</span> <span>${formatter.formatValue(cumul)}</span>
                        </div>
                    </div>
                `;
            }

            function getFase1FFData() {
                const data = new google.visualization.DataTable();
                data.addColumn('string', 'Período');
                data.addColumn('number', 'Despesas Indiretas');
                data.addColumn('number', 'Trecho: Av. Marginal');
                data.addColumn('number', 'Cumulativo');
                data.addColumn({type: 'string', role: 'tooltip', p: {html: true}}); 

                const rows = [
                    ['Período 1', 417428.94, 787061.56,  1204490.5],
                    ['Período 2', 337250.95, 983826.95,  2525568.4],
                    ['Período 3', 337250.95, 196765.39,  3059584.74],
                    ['Período 4', 592306.85, 0,          3651891.59]
                ];
                
                rows.forEach(row => {
                    data.addRow([
                        row[0], row[1], row[2], row[3],
                        createTooltip(row[0], row[1], row[2], row[3])
                    ]);
                });

                formatter.format(data, 1);
                formatter.format(data, 2);
                formatter.format(data, 3);
                return data;
            }

            function getFase2FFData() {
                const data = new google.visualization.DataTable();
                data.addColumn('string', 'Período');
                data.addColumn('number', 'Despesas Indiretas');
                data.addColumn('number', 'Trecho: Av. Marginal');
                data.addColumn('number', 'Cumulativo');
                data.addColumn({type: 'string', role: 'tooltip', p: {html: true}}); 
                
                const rows = [
                    ['P1', 1030331.80, 0,           1030331.80],
                    ['P2', 337250.95,  3340022.17,  4707604.92],
                    ['P3', 337250.95,  3904914.19,  8949770.06],
                    ['P4', 337250.95,  3771313.31,  13058334.32],
                    ['P5', 400650.68,  5616172.08,  19075157.08],
                    ['P6', 337250.95,  6579571.81,  25991979.84], 
                    ['P7', 337250.95,  4000009.76,  30329240.55], 
                    ['P8', 337250.95,  4748593.88,  35415085.38], 
                    ['P9', 337250.95,  715592.14,   36467928.47], 
                    ['P10', 341459.76, -261281.77,  36548106.46] 
                ];

                rows.forEach(row => {
                    data.addRow([
                        row[0], row[1], row[2], row[3],
                        createTooltip(row[0], row[1], row[2], row[3])
                    ]);
                });
                
                formatter.format(data, 1);
                formatter.format(data, 2);
                formatter.format(data, 3);
                return data;
            }
            
            function drawChart(data, elementId, title) {
                const options = {
                    title: title,
                    titleTextStyle: { color: '#333', fontSize: 18, bold: false },
                    fontName: 'system-ui',
                    chartArea: {'width': '85%', 'height': '75%'},
                    legend: { position: 'top', alignment: 'center' },
                    vAxes: {
                        0: { title: 'Valor Periódico (R$)', gridlines: { color: '#e5e7eb' }, format: 'R$ #,##0.00' },
                        1: { title: 'Valor Cumulativo (R$)', gridlines: { color: 'transparent' }, format: 'R$ #,##0.00' }
                    },
                    hAxis: { title: 'Período', slantedText: false },
                    seriesType: 'bars',
                    isStacked: true,
                    series: {
                        2: { 
                            type: 'line', 
                            targetAxisIndex: 1, 
                            color: 'var(--cor-linha-ff)',
                            lineWidth: 3,
                            pointSize: 6,
                            pointsVisible: true
                        }
                    },
                    colors: ['var(--cor-primaria)', 'var(--cor-secundaria)'],
                    tooltip: { isHtml: true } 
                };

                const chart = new google.visualization.ComboChart(document.getElementById(elementId));
                chart.draw(data, options);
            }

            /**
             * Função de Callback principal do Google Charts
             */
            function drawFFCharts() {
                try {
                    // Inicializa o formatador de moeda
                    formatter = new google.visualization.NumberFormat({
                        prefix: 'R$ ',
                        decimalSymbol: ',',
                        groupingSymbol: '.',
                        fractionDigits: 2
                    });

                    // Desenha os gráficos
                    drawChart(getFase1FFData(), 'ff-chart-fase-1', 'Curva S - Físico-Financeiro (Fase 01)');
                    drawChart(getFase2FFData(), 'ff-chart-fase-2', 'Curva S - Físico-Financeiro (Fase 02)');

                    // Lógica das Abas
                    const btnFase1 = document.getElementById('btn-ff-fase-1');
                    const btnFase2 = document.getElementById('btn-ff-fase-2');
                    const wrapperFase1 = document.getElementById('ff-chart-fase-1-wrapper');
                    const wrapperFase2 = document.getElementById('ff-chart-fase-2-wrapper');
                    
                    btnFase1.addEventListener('click', () => {
                        btnFase1.classList.add('active');
                        btnFase2.classList.remove('active');
                        wrapperFase1.style.display = 'block';
                        wrapperFase2.style.display = 'none';
                    });
                    
                    btnFase2.addEventListener('click', () => {
                        btnFase2.classList.add('active');
                        btnFase1.classList.remove('active');
                        wrapperFase2.style.display = 'block';
                        wrapperFase1.style.display = 'none';
                    });
                    
                    // Marca como inicializado e exibe o conteúdo
                    fisicoFinanceiroInicializado = true;
                    loading.style.display = 'none';
                    contentDiv.style.display = 'block';

                } catch (e) {
                     console.error("Falha ao desenhar gráficos FF:", e);
                     errorDiv.textContent = 'Erro ao desenhar gráficos: ' + e.message;
                     errorDiv.style.display = 'block';
                     loading.style.display = 'none';
                }
            }
             
             // Redesenha os gráficos quando a janela muda de tamanho
             window.addEventListener('resize', function() {
                // ATUALIZADO: Verifica a flag ANTES de tentar redesenhar
                if (fisicoFinanceiroInicializado && document.getElementById('fisico-financeiro-page').style.display === 'block') {
                    try {
                        drawFFCharts();
                    } catch (e) {
                        console.error("Erro ao redesenhar gráficos FF:", e);
                    }
                }
            }, true);
        }

        // --- Lógica da Página: Planejamento (Gantt com JSONL) ---
        
        /**
         * Inicializa a página de Planeamento, carregando dados e renderizando o Gantt.
         */
        async function initializeGanttPage() {
            
            const loading = document.getElementById('planejamento-loading');
            const errorDiv = document.getElementById('planejamento-error');
            const contentDiv = document.getElementById('planejamento-content');

            loading.style.display = 'block';
            errorDiv.style.display = 'none';
            contentDiv.style.display = 'none';
            
            let activeGantt = { instance: null };
            let ganttFase1 = null;
            let ganttFase2 = null;
            
            // Data de controle é sempre "hoje"
            const today = new Date();
            today.setHours(0, 0, 0, 0); 

            // Atualiza o display da data de controle
            const controlDateString = today.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
            const controlDateDisplay = document.getElementById('control-date-display');
            if(controlDateDisplay) {
                controlDateDisplay.textContent = controlDateString;
            }
            
            /**
             * Converte uma string YYYY-MM-DD para um objeto Date local (meia-noite).
             */
            function parseDateFromISO(dateStr) {
                if (!dateStr || !dateStr.includes('-')) {
                    console.warn('Data ISO inválida:', dateStr);
                    return new Date(); 
                }
                const parts = dateStr.split('T')[0].split('-').map(Number);
                if (parts.length < 3 || isNaN(parts[0]) || isNaN(parts[1]) || isNaN(parts[2])) {
                        console.warn('Data NaN:', dateStr);
                        return new Date();
                }
                return new Date(parts[0], parts[1] - 1, parts[2], 0, 0, 0); // (Ano, Mês-1, Dia)
            }
            
            /**
             * Carrega tarefas do localStorage.
             */
            function loadTasksFromStorage(key) {
                const stored = localStorage.getItem(key);
                if (stored) {
                    try {
                        const parsed = JSON.parse(stored);
                        return parsed.map(task => ({
                            ...task,
                            start: parseDateFromISO(task.start), // Converte de string para Date
                            end: parseDateFromISO(task.end)
                        }));
                    } catch (e) {
                        console.warn("Erro ao ler localStorage, limpando dados:", e);
                        localStorage.removeItem(key); // Limpa dados corrompidos
                        return [];
                    }
                }
                return [];
            }

            /**
             * Salva tarefas no localStorage no formato YYYY-MM-DD.
             */
            function saveTasksToStorage(key, tasks) {
                try {
                    const serializable = tasks.map(task => ({
                        id: task.id,
                        name: task.name,
                        start: formatDateForFrappe(task.start), // Salva como YYYY-MM-DD
                        end: formatDateForFrappe(task.end),     // Salva como YYYY-MM-DD
                        progress: task.progress,
                        dependencies: task.dependencies,
                        fase: task.fase // Preserva a fase
                    }));
                    localStorage.setItem(key, JSON.stringify(serializable));
                } catch (e) {
                    console.error("Erro ao salvar no localStorage:", e);
                }
            }

            /**
             * Formata um objeto Date para YYYY-MM-DD.
             */
            function formatDateForFrappe(date) {
                if (!(date instanceof Date) || isNaN(date)) {
                    console.warn("Tentando formatar data inválida:", date);
                    return '2025-01-01'; // Data de fallback
                }
                const d = new Date(date);
                let month = '' + (d.getMonth() + 1);
                let day = '' + d.getDate();
                const year = d.getFullYear();
                if (month.length < 2) month = '0' + month;
                if (day.length < 2) day = '0' + day;
                return [year, month, day].join('-');
            }

            /**
             * Calcula o progresso planeado de uma tarefa com base na data de controlo.
             */
            function calculatePlannedProgress(task, controlDate) {
                // Validação de datas
                if (!(task.start instanceof Date) || isNaN(task.start) || !(task.end instanceof Date) || isNaN(task.end)) {
                    console.warn("Tarefa com data inválida:", task);
                    return 0;
                }

                const endOfDay = new Date(task.end.getTime());
                endOfDay.setHours(23, 59, 59, 999);

                const start = task.start.getTime();
                const end = endOfDay.getTime();
                const todayTime = controlDate.getTime(); 

                if (todayTime < start) return 0; // Tarefa ainda não começou
                if (todayTime >= end) return 100; // Tarefa concluída
                if (start === end && todayTime >= start) return 100; // Tarefa de dia único (marco)
                
                const totalDuration = end - start;
                if (totalDuration <= 0) { 
                     return (todayTime >= start) ? 100 : 0;
                }
                
                const elapsedDuration = todayTime - start;
                const progress = (elapsedDuration / totalDuration) * 100;
                
                return Math.max(0, Math.min(100, Math.round(progress)));
            }

            
            /**
             * Carrega tarefas do localStorage ou, se vazio, busca do cronograma.jsonl.
             */
            async function fetchAndLoadTasks() {
                const storageKeyFase1 = 'planejamento-tasks-f1';
                const storageKeyFase2 = 'planejamento-tasks-f2';

                let tasksFase1 = loadTasksFromStorage(storageKeyFase1);
                let tasksFase2 = loadTasksFromStorage(storageKeyFase2);

                // Se não houver dados no localStorage, busca do JSONL
                if (tasksFase1.length === 0 || tasksFase2.length === 0) {
                    console.log('Nenhuma tarefa no localStorage, buscando de cronograma.jsonl...');
                    tasksFase1 = [];
                    tasksFase2 = [];
                    try {
                        const response = await fetch('cronograma.jsonl'); // Carrega o novo arquivo
                        if (!response.ok) {
                            throw new Error(`Não foi possível carregar cronograma.jsonl (Status: ${response.status})`);
                        }
                        const text = await response.text();
                        const lines = text.trim().split('\n');

                        if (lines.length === 0 || (lines.length === 1 && lines[0] === '')) {
                             throw new Error('O ficheiro cronograma.jsonl está vazio.');
                        }

                        lines.forEach(line => {
                            if (line.trim() === '') return;
                            try {
                                const taskData = JSON.parse(line);
                                const task = {
                                    ...taskData,
                                    start: parseDateFromISO(taskData.start), // Converte YYYY-MM-DD para Date
                                    end: parseDateFromISO(taskData.end),
                                    progress: 0 // Progresso inicial
                                };

                                if (task.fase === 'f1') {
                                    tasksFase1.push(task);
                                } else if (task.fase === 'f2') {
                                    tasksFase2.push(task);
                                }
                            } catch (e) {
                                console.warn('Erro ao parsear linha do cronograma.jsonl:', line, e);
                            }
                        });

                        // Salva os dados baixados no localStorage
                        saveTasksToStorage(storageKeyFase1, tasksFase1);
                        saveTasksToStorage(storageKeyFase2, tasksFase2);
                        console.log('Dados do JSONL carregados e salvos no localStorage.');

                    } catch (error) {
                        // Exibe um erro claro na UI
                        errorDiv.textContent = `Erro Crítico: ${error.message}. Verifique se o ficheiro 'cronograma.jsonl' existe.`;
                        errorDiv.style.display = 'block';
                        loading.style.display = 'none'; // Esconde o spinner
                        return null; // Interrompe a execução
                    }
                }

                // Calcula o progresso para ambas as fases
                tasksFase1.forEach(task => task.progress = calculatePlannedProgress(task, today));
                tasksFase2.forEach(task => task.progress = calculatePlannedProgress(task, today));
                
                // Retorna as tarefas prontas
                return { tasksFase1, tasksFase2 };
            }
            // --- FIM DA LÓGICA DE CARREGAMENTO ---

            // Inicia o carregamento das tarefas
            const taskData = await fetchAndLoadTasks();
            if (!taskData) return; // Encerra se o carregamento falhar

            const { tasksFase1, tasksFase2 } = taskData;
            
            /**
             * Cria uma instância do Frappe Gantt.
             */
            function createGanttChart(containerSelector, tasksData) {
                const ganttContainer = document.querySelector(containerSelector);
                if (!ganttContainer) {
                    console.error('Container do Gantt não encontrado:', containerSelector);
                    return null;
                }
                ganttContainer.innerHTML = ""; 

                const tasksDataMap = new Map(tasksData.map(t => [t.id, t]));

                const frappeTasks = tasksData.map(task => ({
                    id: task.id,
                    name: task.name,
                    start: formatDateForFrappe(task.start), // Converte Date para YYYY-MM-DD
                    end: formatDateForFrappe(task.end),     // Converte Date para YYYY-MM-DD
                    progress: task.progress, 
                    dependencies: task.dependencies
                }));

                try {
                    return new Gantt(containerSelector, frappeTasks, {
                        header_height: 50,
                        column_width: 10, // Largura da coluna na "Visualização Dia"
                        step: 24,
                        view_modes: ['Day', 'Week', 'Month'],
                        bar_height: 25,
                        bar_corner_radius: 3,
                        arrow_curve: 5,
                        padding: 18,
                        view_mode: 'Week',
                        date_format: 'YYYY-MM-DD',
                        today_marker: true, // Habilita o marcador de hoje (linha vermelha)
                        custom_popup_html: function(task) {
                            // Cria o popup customizado
                            const originalTask = tasksDataMap.get(task.id);
                            const startDate = originalTask ? originalTask.start.toLocaleDateString('pt-BR', {timeZone: 'UTC'}) : 'N/A';
                            const endDate = originalTask ? originalTask.end.toLocaleDateString('pt-BR', {timeZone: 'UTC'}) : 'N/A';

                            return `
                                <div class="p-2 shadow-lg rounded-md bg-white text-sm" style="min-width: 200px;">
                                  <h4 class="font-bold text-base mb-1" style="color: var(--cor-primaria);">${task.name}</h4>
                                  <p class="text-gray-600 mb-1">Início: ${startDate}</p>
                                  <p class="text-gray-600 mb-2">Fim: ${endDate}</p>
                                  <p class="text-gray-600">Progresso Previsto: ${task.progress}%</p>
                                </div>
                            `;
                        }
                    });
                } catch (e) {
                    console.error("Erro ao inicializar o Frappe Gantt:", e);
                    ganttContainer.innerHTML = `<div class="p-4 text-center text-red-600">Ocorreu um erro ao carregar o gráfico de Gantt. Verifique os dados e as datas.</div>`;
                    return null;
                }
            }
            
            /**
             * Renderiza a tabela de progresso abaixo do Gantt.
             */
            function renderProgressTable(containerSelector, tasks) {
                const container = document.querySelector(containerSelector);
                if (!container) return;
                
                let tableHTML = `
                    <table class="progress-table">
                        <thead>
                            <tr>
                                <th>Atividade</th>
                                <th colspan="2" class="text-center">Avanço Previsto</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                tasks.forEach(task => {
                    const plannedProgress = task.progress; 
                    tableHTML += `
                        <tr>
                            <td>${task.name}</td>
                            <td class="progress-bar-cell">
                                <div class="progress-bar-bg">
                                    <div class="progress-bar-fill" style="width: ${plannedProgress}%;"></div>
                                </div>
                            </td>
                            <td class="progress-text">${plannedProgress}%</td>
                        </tr>
                    `;
                });
                
                tableHTML += `</tbody></table>`;
                container.innerHTML = tableHTML;
            }

            // --- Inicializa os dois gráficos ---
            ganttFase1 = createGanttChart("#gantt-chart-fase-1", tasksFase1); 
            ganttFase2 = createGanttChart("#gantt-chart-fase-2", tasksFase2);
            
            // --- Renderiza as duas tabelas de progresso ---
            renderProgressTable("#progress-table-fase-1", tasksFase1);
            renderProgressTable("#progress-table-fase-2", tasksFase2);

            
            activeGantt.instance = ganttFase1; // Define Fase 1 como ativa por padrão

            // --- Esconde o spinner e mostra o conteúdo ---
            loading.style.display = 'none';
            contentDiv.style.display = 'block';

            // --- Adiciona listeners para os botões de ZOOM ---
            const viewButtons = {
                'day': document.getElementById('gantt-view-day'),
                'week': document.getElementById('gantt-view-week'),
                'month': document.getElementById('gantt-view-month')
            };

            function setActiveZoomButton(mode) {
                Object.values(viewButtons).forEach(btn => btn.classList.remove('active'));
                if (mode === 'Day') viewButtons.day.classList.add('active');
                if (mode === 'Week') viewButtons.week.classList.add('active');
                if (mode === 'Month') viewButtons.month.classList.add('active');
            }

            viewButtons.day.addEventListener('click', () => {
                if (activeGantt.instance) {
                    activeGantt.instance.change_view_mode('Day');
                    setActiveZoomButton('Day');
                }
            });
            viewButtons.week.addEventListener('click', () => {
                 if (activeGantt.instance) {
                    activeGantt.instance.change_view_mode('Week');
                    setActiveZoomButton('Week');
                }
            });
            viewButtons.month.addEventListener('click', () => {
                 if (activeGantt.instance) {
                    activeGantt.instance.change_view_mode('Month');
                    setActiveZoomButton('Month');
                }
            });

            setActiveZoomButton('Week'); // Define 'Semana' como padrão

            // --- Lógica das ABAS DE FASE (Gantt) ---
            const btnFase1 = document.getElementById('btn-fase-1');
            const btnFase2 = document.getElementById('btn-fase-2');
            const wrapperFase1 = document.getElementById('gantt-fase-1-wrapper');
            const wrapperFase2 = document.getElementById('gantt-fase-2-wrapper');
            const tableWrapperFase1 = document.getElementById('progress-table-fase-1');
            const tableWrapperFase2 = document.getElementById('progress-table-fase-2');

            
            btnFase1.addEventListener('click', () => {
                btnFase1.classList.add('active');
                btnFase2.classList.remove('active');
                wrapperFase1.style.display = 'block';
                wrapperFase2.style.display = 'none';
                tableWrapperFase1.style.display = 'block';
                tableWrapperFase2.style.display = 'none';
                
                activeGantt.instance = ganttFase1;
                if(ganttFase1) { 
                    const currentViewMode = ganttFase1.options.view_mode;
                    setActiveZoomButton(currentViewMode);
                }
            });

            btnFase2.addEventListener('click', () => {
                btnFase2.classList.add('active');
                btnFase1.classList.remove('active');
                wrapperFase2.style.display = 'block';
                wrapperFase1.style.display = 'none';
                tableWrapperFase2.style.display = 'block';
                tableWrapperFase1.style.display = 'none';
                
                activeGantt.instance = ganttFase2;
                 if(ganttFase2) { 
                    const currentViewMode = ganttFase2.options.view_mode;
                    setActiveZoomButton(currentViewMode);
                }
            });

        }
        
        // --- NOVA LÓGICA DA PÁGINA: Gestão de Suprimentos (Kraljic) ---
        
        /**
         * Inicializa a página de Gestão de Suprimentos.
         */
        function initializeSuprimentosPage() {
            const loading = document.getElementById('suprimentos-loading');
            const errorDiv = document.getElementById('suprimentos-error');
            const contentDiv = document.getElementById('suprimentos-content');
            
            loading.style.display = 'block';
            errorDiv.style.display = 'none';
            contentDiv.style.display = 'none';
            
            try {
                // Carrega os pacotes 'corechart' (para tabelas) e 'annotationchart' (para os rótulos do scatter)
                google.charts.load('current', {'packages':['corechart', 'annotationchart']});
                google.charts.setOnLoadCallback(loadSuprimentosData); // Chama a função que busca o .jsonl
            } catch(e) {
                 console.error("Falha ao carregar Google Charts para Suprimentos:", e);
                 errorDiv.textContent = 'Erro ao carregar a biblioteca de gráficos do Google.';
                 errorDiv.style.display = 'block';
                 loading.style.display = 'none';
            }
        }

        /**
         * Carrega os dados de 'suprimentos.jsonl' (ou localStorage) e renderiza.
         */
        async function loadSuprimentosData() {
            const loading = document.getElementById('suprimentos-loading');
            const errorDiv = document.getElementById('suprimentos-error');
            const contentDiv = document.getElementById('suprimentos-content');
            const storageKey = 'suprimentos-db';
            let data = [];

            try {
                const storedData = localStorage.getItem(storageKey);
                if (storedData) {
                    console.log('Carregando Suprimentos do localStorage.');
                    data = JSON.parse(storedData);
                } else {
                    console.log('Buscando suprimentos.jsonl...');
                    const response = await fetch('suprimentos.jsonl'); // Carrega o arquivo
                    if (!response.ok) {
                        throw new Error(`Não foi possível carregar suprimentos.jsonl (Status: ${response.status})`);
                    }
                    const text = await response.text();
                    const lines = text.trim().split('\n');
                    
                    if (lines.length === 0 || (lines.length === 1 && lines[0] === '')) {
                         throw new Error('O ficheiro suprimentos.jsonl está vazio.');
                    }
                    
                    lines.forEach((line) => {
                        if (line.trim() === '') return;
                        try {
                            data.push(JSON.parse(line));
                        } catch (e) {
                            console.warn('Erro ao parsear linha do suprimentos.jsonl:', line, e);
                        }
                    });
                    
                    localStorage.setItem(storageKey, JSON.stringify(data)); // Salva no localStorage
                }
                
                if (!data || data.length === 0) {
                    throw new Error("Não há dados de suprimentos para exibir.");
                }

                // Renderiza os componentes da página
                renderSuprimentosTable(data);
                updateKraljicChart(data);
                
                contentDiv.style.display = 'block'; // Mostra o conteúdo

            } catch (error) {
                console.error("Falha ao carregar o banco de dados de Suprimentos:", error);
                errorDiv.textContent = `Erro ao carregar dados: ${error.message}`;
                errorDiv.style.display = 'block';
            } finally {
                loading.style.display = 'none'; // Esconde o spinner
            }
        }
        
        /**
         * Renderiza a tabela de suprimentos.
         */
        function renderSuprimentosTable(data) {
            const tableBody = document.getElementById('suprimentos-table-body');
            let tableHTML = "";

            data.forEach((item) => {
                let statusClass = '';
                if (item.status_entrega === 'Atrasado') statusClass = 'text-red-600 font-medium';
                if (item.status_entrega === 'Em trânsito') statusClass = 'text-blue-600';
                if (item.status_entrega === 'Em estoque') statusClass = 'text-green-600';

                tableHTML += `
                    <tr>
                        <td class="whitespace-nowrap font-medium">${item.id}</td>
                        <td class="break-words">${item.item}</td>
                        <td class="whitespace-nowrap">${item.categoria}</td>
                        <td class="whitespace-nowrap">${item.fornecedor_principal}</td>
                        <td class="whitespace-nowrap ${statusClass}">${item.status_entrega}</td>
                        <td class="text-center">${item.impacto_prazo}</td>
                        <td class="text-center">${item.risco_fornecimento}</td>
                    </tr>
                `;
            });
            tableBody.innerHTML = tableHTML;
        }

        /**
         * Cria o HTML para o tooltip customizado do gráfico Kraljic.
         */
        function createKraljicTooltip(item, quadrante) {
            return `
                <div class="p-2 shadow-lg rounded-md bg-white text-sm" style="min-width: 250px;">
                    <h4 class="font-bold text-base mb-1" style="color: var(--cor-primaria);">${item.item} (ID: ${item.id})</h4>
                    <p class="font-medium text-gray-700">${quadrante}</p>
                    <hr class="my-1">
                    <p class="text-gray-600">Impacto no Prazo: ${item.impacto_prazo} / 10</p>
                    <p class="text-gray-600">Risco de Fornecimento: ${item.risco_fornecimento} / 10</p>
                </div>
            `;
        }
        
        /**
         * Atualiza (desenha) o gráfico da Matriz de Kraljic.
         */
        function updateKraljicChart(data) {
            const chartData = new google.visualization.DataTable();
            chartData.addColumn('number', 'Impacto no Prazo');
            
            // Colunas de DADOS (com tooltips)
            chartData.addColumn('number', 'Itens Não Críticos');
            chartData.addColumn({type: 'string', role: 'tooltip', p: {html: true}});
            chartData.addColumn('number', 'Itens de Gargalo');
            chartData.addColumn({type: 'string', role: 'tooltip', p: {html: true}});
            chartData.addColumn('number', 'Itens de Alavancagem');
            chartData.addColumn({type: 'string', role: 'tooltip', p: {html: true}});
            chartData.addColumn('number', 'Itens Estratégicos');
            chartData.addColumn({type: 'string', role: 'tooltip', p: {html: true}});

            // Colunas de RÓTULOS (com tooltips nulos)
            chartData.addColumn('number', 'Rótulo Não Críticos');
            chartData.addColumn({type: 'string', role: 'annotation'});
            chartData.addColumn({type: 'string', role: 'annotationText'});
            chartData.addColumn('number', 'Rótulo Gargalo');
            chartData.addColumn({type: 'string', role: 'annotation'});
            chartData.addColumn({type: 'string', role: 'annotationText'});
            chartData.addColumn('number', 'Rótulo Alavancagem');
            chartData.addColumn({type: 'string', role: 'annotation'});
            chartData.addColumn({type: 'string', role: 'annotationText'});
            chartData.addColumn('number', 'Rótulo Estratégicos');
            chartData.addColumn({type: 'string', role: 'annotation'});
            chartData.addColumn({type: 'string', role: 'annotationText'});


            // Processa os dados do JSONL
            data.forEach(item => {
                const impacto = item.impacto_prazo;
                const risco = item.risco_fornecimento;
                
                let row = [impacto, 
                    null, null, null, null, null, null, null, null, // Pontos de dados
                    null, null, null, null, null, null, null, null, null, null, null, null // Pontos de rótulo
                ];
                
                if (impacto <= 5 && risco <= 5) { // Não Críticos (Q1)
                    row[1] = risco;
                    row[2] = createKraljicTooltip(item, 'Não Crítico');
                } else if (impacto <= 5 && risco > 5) { // Gargalo (Q2)
                    row[3] = risco;
                    row[4] = createKraljicTooltip(item, 'Gargalo (Bottleneck)');
                } else if (impacto > 5 && risco <= 5) { // Alavancagem (Q3)
                    row[5] = risco;
                    row[6] = createKraljicTooltip(item, 'Alavancagem');
                } else { // Estratégicos (Q4)
                    row[7] = risco;
                    row[8] = createKraljicTooltip(item, 'Estratégico');
                }
                chartData.addRow(row);
            });

            // Adiciona os rótulos dos quadrantes
            chartData.addRow([2.5, null, null, null, null, null, null, null, null, 2.5, 'Itens Não Críticos', 'Baixo Risco, Baixo Impacto no Prazo', null, null, null, null, null, null, null, null, null]);
            chartData.addRow([2.5, null, null, null, null, null, null, null, null, null, null, null, 7.5, 'Itens de Gargalo', 'Alto Risco, Baixo Impacto no Prazo', null, null, null, null, null, null]);
            chartData.addRow([7.5, null, null, null, null, null, null, null, null, null, null, null, null, null, null, 2.5, 'Itens de Alavancagem', 'Baixo Risco, Alto Impacto no Prazo', null, null, null]);
            chartData.addRow([7.5, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, 7.5, 'Itens Estratégicos', 'Alto Risco, Alto Impacto no Prazo']);

            const options = {
                fontName: 'system-ui',
                title: 'Matriz de Kraljic - Portfólio de Suprimentos',
                titleTextStyle: { color: '#333', fontSize: 18, bold: false },
                chartArea: {'width': '85%', 'height': '75%'},
                hAxis: {
                    title: 'Impacto no Prazo',
                    minValue: 0,
                    maxValue: 10,
                    ticks: [
                        {v: 2.5, f: 'Baixo Impacto no Prazo'}, 
                        {v: 5, f: ''}, // Linha central
                        {v: 7.5, f: 'Alto Impacto no Prazo'}
                    ],
                    gridlines: { color: '#ccc', count: 2 } // Grelha central
                },
                vAxis: {
                    title: 'Risco de Fornecimento',
                    minValue: 0,
                    maxValue: 10,
                    ticks: [
                        {v: 2.5, f: 'Baixo Risco'}, 
                        {v: 5, f: ''}, // Linha central
                        {v: 7.5, f: 'Alto Risco'}
                    ],
                    gridlines: { color: '#ccc', count: 2 } // Grelha central
                },
                legend: { position: 'bottom', alignment: 'center' }, 
                tooltip: { isHtml: true, trigger: 'selection' },
                
                series: {
                    0: { color: '#6b7280', pointSize: 7, pointShape: 'circle', dataVisibility: 'all', visibleInLegend: true }, // Não Críticos
                    1: { color: '#f59e0b', pointSize: 7, pointShape: 'triangle', dataVisibility: 'all', visibleInLegend: true }, // Gargalo
                    2: { color: '#01455C', pointSize: 7, pointShape: 'square', dataVisibility: 'all', visibleInLegend: true }, // Alavancagem
                    3: { color: '#dc2626', pointSize: 9, pointShape: 'star', dataVisibility: 'all', visibleInLegend: true }, // Estratégicos
                    
                    // Séries de RÓTULOS (invisíveis)
                    4: { color: 'transparent', pointSize: 0, dataVisibility: 'all', visibleInLegend: false, annotations: { textStyle: { color: '#6b7280', fontSize: 14, bold: true, opacity: 0.7 } } },
                    5: { color: 'transparent', pointSize: 0, dataVisibility: 'all', visibleInLegend: false, annotations: { textStyle: { color: '#f59e0b', fontSize: 14, bold: true, opacity: 0.7 } } },
                    6: { color: 'transparent', pointSize: 0, dataVisibility: 'all', visibleInLegend: false, annotations: { textStyle: { color: '#01455C', fontSize: 14, bold: true, opacity: 0.7 } } },
                    7: { color: 'transparent', pointSize: 0, dataVisibility: 'all', visibleInLegend: false, annotations: { textStyle: { color: '#dc2626', fontSize: 14, bold: true, opacity: 0.7 } } },
                },

                crosshair: { trigger: 'both', orientation: 'both', color: '#ccc', opacity: 0.6 },
                animation:{
                    duration: 1000,
                    easing: 'out',
                    startup: true
                }
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('kraljic-chart'));
            chart.draw(chartData, options);
        }
         
        // NOVO: Redesenha o gráfico de Suprimentos ao redimensionar
         window.addEventListener('resize', function() {
            if (suprimentosInicializado && document.getElementById('suprimentos-page').style.display === 'block') {
                try {
                    loadSuprimentosData(); // Recarrega os dados (do localStorage) e redesenha
                } catch (e) {
                    console.error("Erro ao redesenhar gráfico de Suprimentos:", e);
                }
            }
        }, true);

    });
</script>
</body>
</html>